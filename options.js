const s=document.getElementById("status"),t=document.getElementById("tableContainer");let e=[];document.getElementById("excelFile").addEventListener("change",function(){const t=this.files[0]?.name||"æœªé€‰æ‹©æ–‡ä»¶";document.getElementById("fileName").textContent=t});function n(t){const e=document.createElement("div");e.textContent=t,s.appendChild(e),s.scrollTop=s.scrollHeight}function o(s){if(!s.length)return;const r=Object.keys(s[0]),l={"å“å":"10%","æ²ƒå°”ç›ITEM ID":"10%","ç‹¬ç«‹ç«™é“¾æ¥":"20%","è¯„è®ºå†…å®¹":"40%","åå­—":"5%","é‚®ç®±":"10%"};let a="<table><colgroup>";a+='<col style="width: 5%;">',r.forEach((t=>{const e=l[t]||"15%";a+=`<col style="width: ${e};">`})),a+="</colgroup><thead><tr>",a+="<th>åºå·</th>",r.forEach((t=>{a+=`<th>${t}</th>`})),a+="</tr></thead><tbody>",s.forEach(((s,l)=>{a+=`<tr><td>${l+1}</td>`,r.forEach((t=>{a+=`<td>${s[t]??""}</td>`})),a+="</tr>"})),a+="</tbody></table>",t.innerHTML=a}document.getElementById("excelFile").addEventListener("change",async l=>{t.innerHTML="",n("å¼€å§‹ä¸Šä¼  Excel æ–‡ä»¶...");try{const t=l.target.files[0];if(!t)return void n("æœªé€‰ä¸­æ–‡ä»¶ï¼");n("è¯»å–æ–‡ä»¶ï¼š"+t.name);const s=await t.arrayBuffer(),r=XLSX.read(s,{type:"array"}),a=r.Sheets[r.SheetNames[0]],i=XLSX.utils.sheet_to_json(a);if(!i.length)return void n("Excel å†…å®¹ä¸ºç©ºï¼");n("è¯»å–æˆåŠŸï¼Œå…± "+i.length+" æ¡æ•°æ®"),n(" "),n(" "),e=i,o(e)}catch(t){n("è¯»å–å¤±è´¥: "+t.message)}}),document.getElementById("run").addEventListener("click",async()=>{if(!e.length)return void n("è¯·å…ˆä¸Šä¼  Excel æ–‡ä»¶ï¼");const s=parseFloat(document.getElementById("intervalInput").value)||0,t=1e3*s+2e3;for(let r=0;r<e.length;r++){const l=e[r],a=r+1;try{n(`åºå·${a}ï¼šæ­£åœ¨æ‰“å¼€é“¾æ¥ ${l["ç‹¬ç«‹ç«™é“¾æ¥"]}`);const r=await new Promise(((t,e)=>{chrome.tabs.create({url:l["ç‹¬ç«‹ç«™é“¾æ¥"]},(s=>{chrome.runtime.lastError?e(chrome.runtime.lastError):t(s)}))}));await new Promise((t=>{const e=(s,l)=>{s===r.id&&"complete"===l.status&&(chrome.tabs.onUpdated.removeListener(e),t())};chrome.tabs.onUpdated.addListener(e)})),n(`åºå·${a}ï¼šæ­£åœ¨å¡«å†™æ•°æ®...`),await chrome.scripting.executeScript({target:{tabId:r.id},func:d,args:[l]}),n(`åºå·${a}ï¼šå®Œæˆå¡«å†™å¹¶æäº¤ âœ”`),t>0&&(n(`ç­‰å¾… ${s} ç§’åç»§ç»­ä¸‹ä¸€æ¡...`),await new Promise((e=>setTimeout(e,t)))),await new Promise(((t,e)=>{chrome.tabs.remove(r.id,(()=>{chrome.runtime.lastError?(n(`åºå·${a}ï¼šå…³é—­æ ‡ç­¾é¡µå¤±è´¥ ${chrome.runtime.lastError.message}`),t()):t()}))}))}catch(t){n(`åºå·${a}ï¼šæ“ä½œå¤±è´¥ âŒ  ${t.message}`)}}n("å…¨éƒ¨æ“ä½œå®Œæˆï¼ğŸ‰")});function d(s){const t=(s,t)=>{const e=document.querySelector(s);e&&(e.value=t,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})))};
t("#comment",s["è¯„è®ºå†…å®¹"]),t("#author",s["åå­—"]),t("#email",s["é‚®ç®±"]);const e=document.querySelector("p.stars");if(e){e.classList.add("selected");const s=e.querySelector("a.star-5");s&&(s.classList.add("active"),s.click())}const n=document.querySelector("#submit");n&&n.click()}
